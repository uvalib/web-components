class UvalibModelAjax extends HTMLElement{static get observedAttributes(){return["auto","path","sort-by","sort-order","filter","timeout","poll"]}constructor(){super(),this._apidomain="https://api.devhub.virginia.edu/",this._apiversion="v1"}connectedCallback(){}get auto(){return!!this._auto}set auto(t){this._auto=!!t,this._eval()}get path(){return this._path}set path(t){this._path=t,this._eval()}get sortBy(){return this._sortBy}set sortBy(t){this._sortBy=t,this._eval()}get sortOrder(){return this._sortOrder}set sortOrder(t){this._sortOrder=t,this._eval()}get filter(){return this._filter}set filter(t){this._filter=t,this._eval()}get timeout(){return this._timeout}set timeout(t){this._timeout=t,this._eval()}get poll(){return this._poll}set poll(t){this._poll=t,this._eval()}get items(){return this.lastResponse}attributeChangedCallback(t,i,e){switch(t){case"auto":this.auto=""===e;break;case"path":this.path=e;break;case"sort-by":this.sortBy=e;break;case"sort-order":this.sortOrder=e;break;case"filter":this.filter=e;break;case"timeout":this.timeout=parseInt(e);break;case"poll":this.poll=parseInt(e)}}_eval(){this._auto&&this._path&&this.generateRequest()}_makeURL(){return this._apidomain+this._apiversion+"/"+this._path}generateRequest(){if(!(this.hasAttribute("timeout")&&!this._timeout||this.hasAttribute("poll")&&!this._poll)){console.log(this._makeURL()),this._controller&&this.loading&&this._controller.abort(),this.loading=!0,this._controller=new AbortController,this._timeout&&setTimeout(function(){this._controller.abort()}.bind(this),this._timeout);const t=this._controller.signal;fetch(this._makeURL(),{signal:t}).then(t=>t.json()).then(function(t){this.loading=!1,this.lastResponse=t,this.dispatchEvent(new CustomEvent("last-response-changed",{bubbles:!0,composed:!0}))}.bind(this)).catch(function(t){this.loading=!1,"AbortError"===t.name?console.log("Fetch aborted"):console.error("Uh oh, an error!",t)}.bind(this))}}}window.customElements.define("uvalib-model-ajax",UvalibModelAjax);export default UvalibModelAjax;
